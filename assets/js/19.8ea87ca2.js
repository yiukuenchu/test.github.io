(window.webpackJsonp=window.webpackJsonp||[]).push([[19],{304:function(e,t,r){"use strict";r.r(t);var a=r(1),n=Object(a.a)({},function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[r("h1",{attrs:{id:"前言"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#前言","aria-hidden":"true"}},[e._v("#")]),e._v(" 前言")]),e._v(" "),r("p",[e._v("前一段时间在一个工作项目中，有一个我负责的功能模块是需要读取Excel文件中的数据。涉及到Java对Excel读写，有两种常见的Excel操作方法，分别是"),r("a",{attrs:{href:"https://www.cnblogs.com/puresoul/p/3502139.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("JXL"),r("OutboundLink")],1),e._v("和"),r("a",{attrs:{href:"https://blog.csdn.net/wwd0501/article/details/78780646",target:"_blank",rel:"noopener noreferrer"}},[e._v("POI"),r("OutboundLink")],1),e._v("。这是它们之间的"),r("a",{attrs:{href:"https://www.cnblogs.com/jyh317/p/4065959.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("区别"),r("OutboundLink")],1),e._v("。")]),e._v(" "),r("h2",{attrs:{id:"poi"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#poi","aria-hidden":"true"}},[e._v("#")]),e._v(" POI")]),e._v(" "),r("p",[e._v("考虑到 "),r("strong",[e._v("数据量大")]),e._v(" 的问题，我选择了效率较高的POI。简易代码如下：")]),e._v(" "),r("div",{staticClass:"language- extra-class"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[e._v("//获取workbook对象\nInputStream is = new FileInputStream(file);\nWorkbook wb = new Workbook(is);\n\nArrayList<String> sheetNames = new ArrayList<String>();\n\n//遍历sheet名，存在sheetNames中\nfor(Sheet sheet : wb){\n\tString name = sheet.getSheetName();\n\tsheetNames.add(name);\n}\n\nwb.close();\n")])])]),r("p",[e._v("这里只写了遍历sheet名，就不写如何遍历单元格了（才不是我懒咧😅～），想要了解的小可爱们可以点击上面的POI链接参考。")]),e._v(" "),r("p",[e._v("有的人会说，看上去似乎没有问题诶～（我当时也是这么想的，太简单了！）")]),e._v(" "),r("p",[e._v("但是代码一跑起来，完了，是讨人厌的Out of Memory异常诶～分析过后，初步确认是Excel文件中的数据量太大，哪怕是空行，POI也会把这些空行数据读入内存，最终导致内存溢出。")]),e._v(" "),r("h2",{attrs:{id:"修改run-configurations"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#修改run-configurations","aria-hidden":"true"}},[e._v("#")]),e._v(" 修改Run Configurations")]),e._v(" "),r("p",[e._v("查了一下资料，有人提出通过修改运行内存（调试内存）的方法，解决内存溢出问题。参数为：")]),e._v(" "),r("blockquote",[r("p",[e._v("-Xms1000M -Xmx1000M")])]),e._v(" "),r("p",[r("img",{attrs:{src:"https://ws2.sinaimg.cn/large/006tNbRwgy1fwa0hms8iuj30k20eeq2y.jpg",alt:""}})]),e._v(" "),r("p",[e._v("满怀期待的点了Debug，可是结果还是同样内存溢出。")]),e._v(" "),r("h1",{attrs:{id:"🌟streamingreader"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#🌟streamingreader","aria-hidden":"true"}},[e._v("#")]),e._v(" 🌟StreamingReader")]),e._v(" "),r("p",[e._v("找了很多方法后，大部分都是讲POI读取的实现，没啥实际帮助嘛简直！😠"),r("br"),e._v("\n最终在stackoverflow上找到了一个不同的解决办法，👉"),r("a",{attrs:{href:"https://stackoverflow.com/questions/48337588/poi-streamingreader",target:"_blank",rel:"noopener noreferrer"}},[e._v("使用StreamingReader"),r("OutboundLink")],1),e._v("。")]),e._v(" "),r("h2",{attrs:{id:"实现"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#实现","aria-hidden":"true"}},[e._v("#")]),e._v(" 实现")]),e._v(" "),r("p",[e._v("要在pom.xml中添加依赖：")]),e._v(" "),r("div",{staticClass:"language- extra-class"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[e._v("<dependency>\n\t<groupId>com.monitorjbl</groupId>\n\t<artifactId>xlsx-streamer</artifactId>\n\t<version>1.2.0</version>\n</dependency>\n")])])]),r("p",[e._v("实现代码为：")]),e._v(" "),r("div",{staticClass:"language- extra-class"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[e._v("InputStream is = new FileInputStream(file);\nWorkbook wb= StreamingReader.builder()\n\t.rowCacheSize(100)\t//设置缓存的行数，默认是10\n\t.bufferSize(4096)\t//设置缓存到内存的字节大小，默认是1024\n\t.open(is);\t//打开资源\n")])])]),r("p",[e._v("其他代码则是相同的了。")]),e._v(" "),r("h2",{attrs:{id:"原理"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#原理","aria-hidden":"true"}},[e._v("#")]),e._v(" 原理")]),e._v(" "),r("p",[e._v("把一部分的行先缓存到内存中，如上面代码我设置为缓存100行；这样就避免了一次性加载所有的行数据到内存中引起内存溢出。通过这种 "),r("strong",[e._v("流式读取")]),e._v("的方式，读取大数据量大Excel文件时就不会报out of memory啦！")]),e._v(" "),r("h1",{attrs:{id:"结语"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#结语","aria-hidden":"true"}},[e._v("#")]),e._v(" 结语")]),e._v(" "),r("p",[e._v("这种方式读取速度也是非常快，十几万行道数据，在几秒钟之内就能读取了出来。😄")]),e._v(" "),r("p",[e._v("你也试试？")])])},[],!1,null,null,null);t.default=n.exports}}]);