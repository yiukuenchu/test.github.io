---
category: 
tags:
  - web
date: 2019-06-28
title: Web 开发学习笔记（一）| OAuth2 协议
vssue-title: oauth2
---

# 前言

一个月没更啦，最近在学习 Web 开发中的更为深入的一些知识，接下来打算把学习过程中值得记录的东西写进博客里分享，做成一个学习笔记系列。

这是这个系列的第一篇，我们来讲讲 **OAuth2 协议**。

# OAuth2 是什么

我们在上网时，往往在可以某个网站的登录页面看到有第三方登录的选项，这些第三方登录可以是微信、QQ、微博、GitHub等。通过这些第三方登录后，我们可以在原来的这个网站获取到我们在相应的第三方服务的用户信息（头像、昵称、邮箱...）。当前这种第三方登录采用的协议大多就叫 OAuth2。

# OAuth2 原理

首先需要明白以下角色：

- 资源所有者（Resource Owner）：指用户自己，也就是我们本身
- 资源服务器（Resource Server）：指第三方服务商的服务器，如微信、QQ、微博它们提供资源的服务器，我们的头像、昵称、邮箱等信息就存储在这里
- 客户端（Client）：指我们要登录的站点等
- 认证服务器（Authorization Server）：用来提供能向资源服务器获取资源的授权

明白了上述，接下来看看最典型的 OAuth2 的工作流程吧：

1. 客户端向资源所有者请求授权
2. 客户端收到授权许可
3. 客户端使用获得的授权向认证服务器申请令牌
4. 认证服务器验证授权许可，返回 Access Token
5. 客户端通过 Access Token 访问资源服务器
6. 资源服务器验证 Access Token 有效性
7. 资源服务器返回受保护的资源

# OAuth2 授权方式

1. 授权码模式：最经典的 OAuth2 认证，**推荐使用**。
2. 密码模式：用户向客户端提供第三方登录服务的账号密码，**最不推荐**，容易泄漏账号密码。
3. 简化模式：省略了授权码模式中第三方服务器向后台获取 Token 的步骤，将这一步简化为将 Token 直接写入 URL 中传回客户端，因此这种模式中客户端不需要向认证服务器申请授权。不推荐，Token 会被明文暴露。
4. 客户端模式：客户端已自己而非用户的名义向第三方申请认证，通过客户端的密钥去获取 Token，用户没有参与进来。为后台 API 服务消费者设计。

# 总结

我们需要第三方登录，除了方便，更多的是信任问题，因此我们把登录的信息交给我们所信任的第三方服务（微信、微博、QQ、GitHub...），从而减少了账号密码泄漏的可能性。